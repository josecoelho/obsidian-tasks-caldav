---
name: Set up local CalDAV server for integration testing
status: open
created: 2026-02-12T02:23:00Z
updated: 2026-02-12T02:23:00Z
github: https://github.com/josecoelho/obsidian-tasks-caldav/issues/22
depends_on: [13]
parallel: true
conflicts_with: []
---

# Task: Set up local CalDAV server for integration testing

## Description
Set up a local CalDAV server (Radicale via Docker) and write integration tests that run against it. This replaces manual testing in Obsidian and provides real end-to-end coverage of the CalDAV protocol — line folding, TZID dates, VTIMEZONE blocks, and full CRUD round-trips.

The current `CalDAVClientDirect` is tightly coupled to Obsidian's `requestUrl`. To test against a real server, extract the HTTP layer into an interface so the same client logic works with `fetch` (tests) and `requestUrl` (Obsidian runtime).

## Acceptance Criteria
- [ ] `docker-compose.yml` at project root with Radicale service for easy setup (`docker compose up -d`)
- [ ] Radicale CalDAV server starts/stops via docker compose in test setup
- [ ] HTTP layer abstracted: interface for request execution, two implementations (`requestUrl` for Obsidian, `fetch` for Node.js tests)
- [ ] Integration tests PUT VTODOs with known tricky content (folded lines, TZID dates, VTIMEZONE blocks)
- [ ] Integration tests fetch VTODOs back and parse through VTODOMapper
- [ ] Full CRUD round-trip tested: create → fetch → update → fetch → delete → fetch
- [ ] Tests can run with `npm test` (skip if Docker not available)
- [ ] npm script for e2e tests: `npm run test:e2e` (starts compose, runs tests, stops compose)

## Technical Details
- **New file:** `docker-compose.yml` — Radicale service definition with test config
- **New dir:** `docker/radicale/` — Radicale config and initial data for testing
- **Docker image:** `tomsquest/docker-radicale` (lightweight, full VTODO support)
- **New file:** `src/caldav/httpAdapter.ts` — interface + two implementations
- **Modified file:** `src/caldav/calDAVClientDirect.ts` — accept adapter via constructor
- **New test file:** `src/caldav/calDAVClientDirect.e2e.test.ts` — real server tests
- **Test helper:** `test/helpers/radicaleServer.ts` — docker compose lifecycle management

## Dependencies
- [ ] Docker must be available on test machine
- [ ] Issue #13 (VTODO parser fixes) should be merged first

## Effort Estimate
- Size: M
- Hours: 4-6
- Parallel: true (can start after #13 is merged)
