---
name: Fix VTODO parser — RFC 5545 line folding and VTIMEZONE dates
status: closed
created: 2026-02-12T00:23:37Z
updated: 2026-02-12T03:14:12Z
github: https://github.com/josecoelho/obsidian-tasks-caldav/issues/13
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Fix VTODO parser — RFC 5545 line folding and VTIMEZONE dates

## Description
Fix two parsing issues in `src/caldav/vtodoMapper.ts` that cause data loss with real CalDAV servers:
1. **Line folding (GitHub #7):** RFC 5545 allows long property values to be folded across lines using CRLF+space continuation. Our parser only reads single lines, truncating folded values.
2. **VTIMEZONE dates (GitHub #8):** Some servers (DAVx5/Tasks.org) emit dates with TZID parameters (`DUE;TZID=Pacific/Auckland:20260214T060001`) instead of `VALUE=DATE`. Our `extractDateProperty` expects 8-char `YYYYMMDD` and returns null for these.

## Acceptance Criteria
- [ ] iCal data is unfolded before property extraction (`data.replace(/\r?\n[ \t]/g, '')`)
- [ ] TZID-parameterized dates are parsed correctly (strip time component, extract date-only)
- [ ] Existing VTODO test fixtures still pass
- [ ] New tests added for folded lines and TZID dates using `test-fixtures/vtodos/3507578162627955783.ics`

## Technical Details
- **File:** `src/caldav/vtodoMapper.ts`
- **Test file:** `src/caldav/vtodoMapper.test.ts`
- **Fixture:** `test-fixtures/vtodos/3507578162627955783.ics` (recurring task from DAVx5 with VTIMEZONE)
- **Line folding fix:** Add unfold step at the top of `vtodoToTask()` before any property extraction
- **TZID fix:** Update `extractDateProperty` to handle both `VALUE=DATE:YYYYMMDD` and `TZID=...:YYYYMMDDTHHMMSS` formats

## Dependencies
- [ ] None — standalone fix

## Effort Estimate
- Size: S
- Hours: 2-4
- Parallel: true
