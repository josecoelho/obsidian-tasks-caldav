---
name: Define CommonTask type and build sync adapters
status: open
created: 2026-02-12T00:23:37Z
updated: 2026-02-12T00:28:04Z
github: https://github.com/josecoelho/obsidian-tasks-caldav/issues/15
depends_on: [13]
parallel: false
conflicts_with: []
---

# Task: Define CommonTask type and build sync adapters

## Description
Create the typed intermediate representation (`CommonTask`) and two adapters (`ObsidianAdapter`, `CalDAVAdapter`) that normalize tasks from each system into a common format. This is part 1 of the sync engine rewrite (GitHub #6, ADR-005).

The current sync engine uses `any` throughout and interleaves format conversion with sync logic. This task separates concerns: adapters handle normalization, the diff engine (task 003) handles sync logic.

## Acceptance Criteria
- [ ] `CommonTask` interface defined with: uid, description, status, dates (due, start, scheduled, completed), priority, tags, recurrence
- [ ] `ObsidianAdapter.normalize(tasks: Task[]): CommonTask[]` converts obsidian-tasks objects to CommonTask
- [ ] `ObsidianAdapter.applyChanges(changes: Change[])` writes updates back to vault
- [ ] `CalDAVAdapter.normalize(vtodos: VTodo[]): CommonTask[]` converts VTODOs to CommonTask
- [ ] `CalDAVAdapter.applyChanges(changes: Change[])` writes updates to CalDAV server
- [ ] No `any` types in adapter code
- [ ] Unit tests for both adapters with round-trip verification

## Technical Details
- **New files:**
  - `src/sync/types.ts` — `CommonTask`, `Change`, `Changeset` interfaces
  - `src/sync/obsidianAdapter.ts` — normalize obsidian-tasks Task objects
  - `src/sync/obsidianAdapter.test.ts`
  - `src/sync/caldavAdapter.ts` — normalize VTODOs via vtodoMapper
  - `src/sync/caldavAdapter.test.ts`
- **Existing code to reuse:**
  - `src/caldav/vtodoMapper.ts` — VTODO parsing/generation (used by CalDAVAdapter)
  - `src/tasks/taskManager.ts` — vault read/write operations (used by ObsidianAdapter)
  - `src/types/obsidianTasksApi.ts` — Task type definitions
- **Key design:** CommonTask uses ISO date strings (not Moment.js) and string enums for status/priority to keep it serializable for baseline snapshots

## Dependencies
- [ ] Task 001 (parser fixes) — ensures CalDAVAdapter handles edge cases correctly

## Effort Estimate
- Size: M
- Hours: 6-10
- Parallel: false (depends on 001)
